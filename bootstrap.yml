---
- hosts: all
  become: yes
  gather_facts: false
  pre_tasks:
  - name: Upgrade system
    raw: sudo apt-get update && sudo apt-get -qy dist-upgrade && sudo apt-get -y autoremove --purge && sudo apt-get -qy clean
  - name: Install Python for Ansible
    raw: test -e /usr/bin/python || (sudo apt-get update && sudo apt-get -qy install python-minimal)
    changed_when: false
  - name: Provision Ansible user
    user:
      name: deploy
  - name: Provision Ansible user authorized keys
    authorized_key:
      user: deploy
      key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEcgOJRwnx/+oY/s4k/NkSYDEKCjHVm1cwkhFFVTDuBq Deploy
      exclusive: yes
  - name: Add Ansible user to Sudoers
    lineinfile:
      path: /etc/sudoers.d/00_deploy
      line: 'deploy ALL=(ALL) NOPASSWD: ALL'
      state: present
      mode: 0440
      create: yes
      validate: 'visudo -cf %s'
  - name: Gathering Facts
    setup:
